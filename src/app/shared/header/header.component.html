<div class="header-wrapper">
  <!-- Logo -->
  <div class="img-wrapper" [class.img-wrapper--chat-open]="isChatOpen">
    <!-- Normal Logo (Desktop/Tablet ohne Chat) -->
    <!-- Normal Logo (Desktop immer, auÃŸerdem wenn Chat nicht offen) -->
    <ng-container *ngIf="!isChatOpen || isDesktop">
      <img src="/public/images/dabubble-logo.svg" class="logo-bubble" alt="DaBubble" />
      <img src="/public/images/Logo name.svg" class="logo-text" alt="DaBubble" />
    </ng-container>

    <!-- Chat Open: Back Button + Workspace Logo (nur Mobile/Tablet) -->
    <ng-container *ngIf="isChatOpen && !isDesktop">
      <button type="button" class="back-button" aria-label="ZurÃ¼ck zu Channels" (click)="goBack()">
        <img src="/public/images/arrow_to_left.svg" class="back-icon back-icon-normal" alt="" />
        <img src="/public/images/arrow_to_left_hover.svg" class="back-icon back-icon-hover" alt="" />
      </button>

      <div class="ws-brand-header">
        <img class="ws-logo-header" src="/public/images/devspace-logo.svg" alt="Devspace" />
        <span class="ws-title-header">Devspace</span>
      </div>
    </ng-container>
  </div>

  <!-- Search -->
  <div class="input-wrapper" *ngIf="!isNewMessageRoute" (click)="$event.stopPropagation()">
    <input #searchInput type="text" placeholder="Devspace durchsuchen" [value]="searchTerm"
      (input)="setSearch($any($event.target).value)" (focus)="openSearch()" (keydown)="onSearchKeydown($event)" />
    <img src="/public/images/search.svg" class="input-search-icon" alt="Search" />

    <div class="search-results" *ngIf="searchOpen" (click)="$event.stopPropagation()">
      <ng-container *ngIf="results$ | async as results">
        <ng-container *ngIf="results.length; else noResults">
          <button type="button" class="search-item" *ngFor="let r of results; let i = index"
            [class.active]="i === activeIndex" (click)="onSelectResult(r)">
            <span class="kind" *ngIf="r.kind === 'channel'">#</span>
            <span class="kind" *ngIf="r.kind === 'user'">&#64;</span>
            <span class="kind" *ngIf="r.kind === 'message'">ðŸ’¬</span>

            <span class="label" *ngIf="r.kind === 'channel'">{{ r.name }}</span>
            <span class="label" *ngIf="r.kind === 'user'">{{ r.name }}</span>
            <span class="label message" *ngIf="r.kind === 'message'">{{ r.text }}</span>
          </button>
        </ng-container>

        <ng-template #noResults>
          <div class="search-empty">Keine Treffer</div>
        </ng-template>
      </ng-container>
    </div>
  </div>

  <!-- Profile -->
  <div class="profile-area" (click)="$event.stopPropagation()">
    <button type="button" class="profile-trigger" (click)="toggleProfile()" [attr.aria-expanded]="profileOpen">
      <ng-container *ngIf="user$ | async as user">
        <span class="name-text">{{ user.name }}</span>

        <span class="avatar-wrap">
          <img [src]="user.avatarUrl" class="profile-img" alt="Avatar" />
          <span class="online-status-dot"></span>
        </span>

        <img src="/public/images/channel-info-arrow-down.svg" class="arrow-down" alt="" />
      </ng-container>
    </button>

    <!-- Dropdown -->
    <div class="profile-menu ui-popover" *ngIf="profileOpen" (click)="$event.stopPropagation()">
      <button type="button" class="menu-btn menu-btn--profile" (click)="openProfileModal()">
        <span class="menu-ic" aria-hidden="true"></span>
        <span>Profil</span>
      </button>

      <button type="button" class="menu-btn menu-btn--logout" (click)="logout()">
        <span class="menu-ic" aria-hidden="true"></span>
        <span>Log out</span>
      </button>
    </div>
  </div>

  <!-- Overlay (fÃ¼r Modal) -->
  <div class="ui-overlay" *ngIf="profileOpen || profileModalOpen" (click)="closeAll()"></div>

  <!-- PROFIL MODAL -->
  <div class="ui-modal ui-modal--right" *ngIf="profileModalOpen" (click)="closeAll()">
    <div class="ui-modal__panel profile-modal__panel" (click)="$event.stopPropagation()">
      <ng-container *ngIf="user$ | async as user">

        <!-- HEADER: Titel je nach View -->
        <div class="ui-modal__header profile-modal__header">
          <h3>{{ profileView === 'edit' ? 'Dein Profil bearbeiten' : 'Profil' }}</h3>
          <button type="button" class="ui-modal__close profile-modal__close" (click)="closeProfileModal()">Ã—</button>
        </div>

        <!-- VIEW: Profil anzeigen -->
        <div class="ui-modal__body profile-modal__content" *ngIf="profileView === 'view'">
          <div class="profile-modal__avatar">
            <img [src]="user.avatarUrl" alt="Avatar" />
          </div>

          <div class="profile-modal__row">
            <div class="profile-modal__name">{{ user.name }}</div>
            <button type="button" class="profile-modal__edit" (click)="openEditProfile(user)">
              Bearbeiten
            </button>
          </div>

          <div class="profile-modal__status">
            <span class="status-dot" [class.online]="user.status === 'active'"></span>
            <span class="status-text">{{ user.status === 'active' ? 'Aktive' : 'Abwesend' }}</span>
          </div>

          <div class="profile-modal__mail">
            <span class="mail-icon">âœ‰</span>
            <div class="mail-block">
              <div class="mail-title">E-Mail-Adresse</div>
              <a class="mail-link" [href]="'mailto:' + user.email">{{ user.email }}</a>
            </div>
          </div>
        </div>

        <!-- EDIT: Profil bearbeiten (gleiche Box, anderer Inhalt) -->
        <div class="ui-modal__body profile-edit__content" *ngIf="profileView === 'edit'">
          <div class="profile-modal__avatar">
            <img [src]="user.avatarUrl" alt="Avatar" />
          </div>

          <label class="profile-edit__label">
            <span class="profile-edit__label-row">
              <span class="profile-edit__icon"> <img src="/public/images/account-circle.svg" alt=""
                  aria-hidden="true" />
              </span>
              <span>VollstÃ¤ndiger Name</span>
            </span>

            <input class="profile-edit__input" type="text" [value]="editName"
              (input)="editName = $any($event.target).value" placeholder=" " />
          </label>

          <div class="profile-edit__actions">
            <button type="button" class="profile-edit__btn outline" (click)="backToProfileView()">
              Abbrechen
            </button>

            <button type="button" class="profile-edit__btn primary" (click)="saveProfile(user)">
              Speichern
            </button>
          </div>
        </div>

      </ng-container>
    </div>
  </div>
</div>