<app-header></app-header>

<div c class="shell" [class.shell--mobile-chat]="mobileView === 'chat'"
  [class.shell--mobile-list]="mobileView === 'list'" [class.shell--mobile-thread]="mobileView === 'thread'"
  [class.shell--workspace-collapsed]="workspaceCollapsed" [class.shell--thread-open]="vm().open">
  <button class="workspace-toggle" type="button" (click)="toggleWorkspace()">
    <span class="workspace-toggle-icon"></span>
    <span class="workspace-toggle-label">
      {{ workspaceCollapsed ? 'Workspace-Menü öffnen' : 'Workspace-Menü schließen' }}
    </span>
  </button>
  <aside class="shell__left">
    <app-channels (workspaceCollapsedChange)="onWorkspaceCollapsedChange($event)"></app-channels>
  </aside>

  <main class="shell__center" [class.shell__center--thread-open]="vm().open">
    <router-outlet></router-outlet>
  </main>

  <aside class="shell__right" [class.is-open]="vm().open" aria-label="Thread">
    <!-- Desktop: nur wenn Thread offen ist -->
    <ng-container *ngIf="vm().open && mobileView !== 'thread'">
      <app-thread [currentUserId]="currentUser?.id ?? null" [channelId]="vm().channelId!" [header]="vm().header!"
        [rootMessage]="vm().root!" [replies]="vm().replies" [users]="usersAllForMentions" [isDM]="vm().isDM || false"
        (send)="onSend($event)" (edit)="onEditThreadMessage($event)" (close)="onClose()">
      </app-thread>
    </ng-container>
    <!-- Mobile: immer wenn im Thread-Modus -->
    <ng-container *ngIf="mobileView === 'thread' && vm().open">
      <app-thread [header]="vm().header!" [rootMessage]="vm().root!" [replies]="vm().replies"
        [users]="usersAllForMentions" [currentUserId]="currentUser?.id || null" [channelId]="vm().channelId!"
        [isDM]="vm().isDM || false" (send)="onSend($event)" (edit)="onEditThreadMessage($event)"
        (close)="onClose()"></app-thread>
    </ng-container>
  </aside>
</div>