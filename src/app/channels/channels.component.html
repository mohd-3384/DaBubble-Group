<div class="workspace-wrapper" [class.is-collapsed]="workspaceCollapsed()">
  <!-- Sidebar-Panel -->
  <div class="workspace-panel">

    <!-- HEADER / BRAND -->
    <header class="ws-header">
      <div class="ws-brand">
        <img class="ws-logo" src="/public/images/devspace-logo.svg" alt="Devspace" />
        <span class="ws-title">Devspace</span>
      </div>

      <button class="icon-swap edit" type="button" aria-label="Neue Nachricht" title="Neue Nachricht"
        (click)="startNewMessage()">
      </button>
    </header>

    <!-- CHANNELS -->
    <div class="ws-sections">
      <section class="ws-section">
        <div class="section-header channels-header">
          <div class="left" (click)="toggleChannels()" [attr.aria-expanded]="!collapsedChannels()">
            <img class="arrow" [class.rotated]="collapsedChannels()" src="/public/images/arrow-drop-down.svg"
              alt="Ein-/Ausklappen" />
            <img class="section-icon" src="/public/images/workspaces.svg" alt="Channels" />
            <span class="title">Channels</span>
          </div>

          <button class="icon-swap add" type="button" aria-label="Channel hinzufügen" title="Channel hinzufügen"
            (click)="openCreateChannelModal()">
          </button>
        </div>

        <mat-nav-list *ngIf="!collapsedChannels()">
          <a mat-list-item *ngFor="let c of (channels$ | async); trackBy: trackByCid" [routerLink]="['/channel', c.id]"
            routerLinkActive="active">
            <div matLine># {{ c.id }}</div>
            <span class="spacer"></span>
          </a>

          <!-- Inline "Channel hinzufügen" -->
          <div mat-list-item class="add-inline" (click)="openCreateChannelModal()" role="button" tabindex="0"
            aria-label="Channel hinzufügen">
            <span class="add-circle" aria-hidden="true"></span>
            <span class="add-text">Channel hinzufügen</span>
          </div>
        </mat-nav-list>
      </section>

      <!-- DIREKTNACHRICHTEN -->
      <section class="ws-section">
        <div class="section-header dms-header">
          <div class="left" (click)="toggleDMs()" [attr.aria-expanded]="!collapsedDMs()">
            <img class="arrow" [class.rotated]="collapsedDMs()" src="/public/images/arrow-drop-down.svg"
              alt="Ein-/Ausklappen" />
            <img class="section-icon" src="/public/images/account-circle.svg" alt="Direktnachrichten" />
            <span class="title">Direktnachrichten</span>
          </div>

          <span class="section-spacer"></span>
        </div>

        <mat-nav-list *ngIf="!collapsedDMs()">
          <a mat-list-item *ngFor="let u of (users$ | async); trackBy: trackByUid" [routerLink]="['/dm', u.id]"
            routerLinkActive="active">
            <img matListItemAvatar [src]="u.avatarUrl || '/public/images/avatars/avatar1.svg'" [alt]="u.name" />

            <div matLine>
              {{ u.name }}
              <span class="muted" *ngIf="u.id === meId">(Du)</span>
            </div>

            <span class="spacer"></span>

            <span class="dot" [class.dot--online]="u.online" matTooltip="{{ u.online ? 'Online' : 'Offline' }}">
            </span>
          </a>
        </mat-nav-list>
      </section>
    </div>
  </div>

  <!-- CHANNEL ERSTELLEN MODAL -->
  <div class="ui-overlay" *ngIf="createChannelOpen"></div>

  <div class="ui-modal" *ngIf="createChannelOpen" (click)="closeCreateChannelModal()">
    <div class="ui-modal__panel channel-modal__panel" (click)="$event.stopPropagation()">
      <div class="ui-modal__header channel-modal__header">
        <h3>Channel erstellen</h3>
        <button type="button" class="ui-modal__close" (click)="closeCreateChannelModal()">
          ×
        </button>
      </div>

      <div class="ui-modal__body channel-modal__body">
        <p class="channel-modal__intro">
          Channels dienen deinem Team zur Kommunikation. Am besten sollten sie themenbezogen sein,
          <strong>#marketing</strong> zum Beispiel.
        </p>

        <form class="channel-modal__form" (ngSubmit)="submitCreateChannel()">
          <!-- Channel-Name -->
          <label class="channel-modal__field">
            <div class="channel-modal__label-row">
              <span class="channel-modal__label">Channel-Name</span>
            </div>

            <div class="channel-input-wrap">
              <span class="channel-hash">#</span>
              <input class="channel-input" type="text" name="channelName" required autocomplete="off"
                placeholder="z.B. Kooperationsprojekte" [(ngModel)]="newChannelName" />
            </div>
          </label>

          <!-- Beschreibung -->
          <label class="channel-modal__field">
            <div class="channel-modal__label-row">
              <span class="channel-modal__label">Beschreibung</span>
              <span class="channel-modal__optional">(optional)</span>
            </div>

            <div class="channel-input-wrap channel-input-wrap--textarea">
              <textarea class="channel-textarea" name="channelDescription" placeholder="Dein Text hier" maxlength="80"
                [(ngModel)]="newChannelDescription">
              </textarea>
            </div>
          </label>

          <!-- Aktionen -->
          <div class="channel-modal__actions">
            <button type="submit" class="channel-btn channel-btn--primary"
              [disabled]="!(newChannelName && newChannelName.trim().length)">
              Erstellen
            </button>
          </div>
        </form>

      </div>
    </div>
  </div>

</div>
