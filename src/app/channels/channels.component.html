<div class="workspace-wrapper" [class.is-collapsed]="workspaceCollapsed()">
  <!-- Sidebar-Panel -->
  <div class="workspace-panel">

    <!-- HEADER / BRAND -->
    <header class="ws-header">
      <!-- Desktop: Brand + Edit -->
      <div class="ws-header__desktop">
        <div class="ws-brand">
          <img class="ws-logo" src="/public/images/devspace-logo.svg" alt="Devspace" />
          <span class="ws-title">Devspace</span>
        </div>

        <button class="icon-swap edit" type="button" aria-label="Neue Nachricht" title="Neue Nachricht"
          (click)="startNewMessage()"></button>
      </div>

      <!-- Tablet/Mobile: Search -->
      <div class="ws-header__search" (click)="$event.stopPropagation()">
        <input #wsSearchInput type="text" placeholder="Gehe zu..." [value]="wsSearchTerm"
          (input)="setWsSearch($any($event.target).value)" (focus)="openWsSearch()"
          (keydown)="onWsSearchKeydown($event)" />
        <img src="/public/images/search.svg" class="ws-search-icon" alt="Search" />

        <div class="ws-search-results" *ngIf="wsSearchOpen" (click)="$event.stopPropagation()">
          <ng-container *ngIf="wsResults$ | async as results">
            <ng-container *ngIf="results.length; else wsNoResults">
              <button type="button" class="ws-search-item" *ngFor="let r of results; let i = index"
                [class.active]="i === wsActiveIndex" (click)="onSelectWsResult(r)">
                <span class="kind" *ngIf="r.kind === 'channel'">#</span>
                <span class="kind" *ngIf="r.kind === 'user'">&#64;</span>
                <span class="kind" *ngIf="r.kind === 'message'">ðŸ’¬</span>

                <span class="label" *ngIf="r.kind === 'channel'">{{ r.id }}</span>
                <span class="label" *ngIf="r.kind === 'user'">{{ r.name }}</span>
                <span class="label message" *ngIf="r.kind === 'message'">{{ r.text }}</span>
              </button>
            </ng-container>

            <ng-template #wsNoResults>
              <div class="ws-search-empty">Keine Treffer</div>
            </ng-template>
          </ng-container>
        </div>
      </div>
    </header>

    <!-- CHANNELS -->
    <div class="ws-sections">
      <section class="ws-section">
        <div class="section-header channels-header">
          <div class="left" (click)="toggleChannels()" [attr.aria-expanded]="!collapsedChannels()">
            <img class="arrow" [class.rotated]="collapsedChannels()" src="/public/images/arrow-drop-down.svg"
              alt="Ein-/Ausklappen" />
            <img class="section-icon" src="/public/images/workspaces.svg" alt="Channels" />
            <span class="title">Channels</span>
          </div>

          <button class="icon-swap add" type="button" aria-label="Channel hinzufÃ¼gen" title="Channel hinzufÃ¼gen"
            (click)="openCreateChannelModal()">
          </button>
        </div>

        <mat-nav-list *ngIf="!collapsedChannels()">
          <a mat-list-item *ngFor="let c of (channels$ | async); trackBy: trackByCid" [routerLink]="['/channel', c.id]"
            routerLinkActive="active">
            <div matLine># {{ c.id }}</div>
            <span class="spacer"></span>
          </a>

          <!-- Inline "Channel hinzufÃ¼gen" -->
          <div mat-list-item class="add-inline" (click)="openCreateChannelModal()" role="button" tabindex="0"
            aria-label="Channel hinzufÃ¼gen">
            <span class="add-circle" aria-hidden="true"></span>
            <span class="add-text">Channel hinzufÃ¼gen</span>
          </div>
        </mat-nav-list>
      </section>

      <!-- DIREKTNACHRICHTEN -->
      <section class="ws-section">
        <div class="section-header dms-header">
          <div class="left" (click)="toggleDMs()" [attr.aria-expanded]="!collapsedDMs()">
            <img class="arrow" [class.rotated]="collapsedDMs()" src="/public/images/arrow-drop-down.svg"
              alt="Ein-/Ausklappen" />
            <img class="section-icon" src="/public/images/account-circle.svg" alt="Direktnachrichten" />
            <span class="title">Direktnachrichten</span>
          </div>

          <span class="section-spacer"></span>
        </div>

        <mat-nav-list *ngIf="!collapsedDMs()">
          <a mat-list-item *ngFor="let u of (users$ | async); trackBy: trackByUid" [routerLink]="['/dm', u.id]"
            routerLinkActive="active">
            <img matListItemAvatar [src]="u.avatarUrl || '/public/images/avatars/avatar1.svg'" [alt]="u.name" />

            <div matLine>
              {{ u.name }}
              <span class="muted" *ngIf="u.id === meId">(Du)</span>
            </div>

            <span class="spacer"></span>

            <span class="dot" [class.dot--online]="u.online" matTooltip="{{ u.online ? 'Online' : 'Offline' }}">
            </span>
          </a>
        </mat-nav-list>
      </section>
    </div>
  </div>

  <!-- CHANNEL ERSTELLEN MODAL -->
  <div class="ui-overlay" *ngIf="createChannelOpen"></div>

  <div class="ui-modal" *ngIf="createChannelOpen" (click)="closeCreateChannelModal()">
    <div class="ui-modal__panel channel-modal__panel" (click)="$event.stopPropagation()">
      <div class="ui-modal__header channel-modal__header">
        <h3>Channel erstellen</h3>
        <button type="button" class="ui-modal__close" (click)="closeCreateChannelModal()">
          Ã—
        </button>
      </div>

      <div class="ui-modal__body channel-modal__body">
        <p class="channel-modal__intro">
          Channels dienen deinem Team zur Kommunikation. Am besten sollten sie themenbezogen sein,
          <strong>#marketing</strong> zum Beispiel.
        </p>

        <form class="channel-modal__form" (ngSubmit)="submitCreateChannel()">
          <!-- Channel-Name -->
          <label class="channel-modal__field">
            <div class="channel-modal__label-row">
              <span class="channel-modal__label">Channel-Name</span>
            </div>

            <div class="channel-input-wrap">
              <span class="channel-hash">#</span>
              <input class="channel-input" type="text" name="channelName" required autocomplete="off"
                placeholder="z.B. Kooperationsprojekte" [(ngModel)]="newChannelName" />
            </div>
          </label>

          <!-- Beschreibung -->
          <label class="channel-modal__field">
            <div class="channel-modal__label-row">
              <span class="channel-modal__label">Beschreibung</span>
              <span class="channel-modal__optional">(optional)</span>
            </div>

            <div class="channel-input-wrap channel-input-wrap--textarea">
              <textarea class="channel-textarea" name="channelDescription" placeholder="Dein Text hier" maxlength="160"
                [(ngModel)]="newChannelDescription">
              </textarea>
            </div>
          </label>

          <!-- Aktionen -->
          <div class="channel-modal__actions">
            <button type="submit" class="channel-btn channel-btn--primary"
              [disabled]="!(newChannelName && newChannelName.trim().length)">
              Erstellen
            </button>
          </div>
        </form>

      </div>
    </div>
  </div>

  <!-- MOBILE FAB: Neue Nachricht -->
  <button class="fab-new-message" type="button" aria-label="Neue Nachricht" title="Neue Nachricht"
    (click)="startNewMessage()">
  </button>

</div>